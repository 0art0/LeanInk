[{"tailPos":2259,"headPos":2252,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ ∀ (a : Fin (n + 1)), card ↑({a}ᶜ) = card (Fin n)"],"goalsAfter":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\na : Fin (n + 1)\n⊢ card ↑({a}ᶜ) = card (Fin n)"],"content":"intro a"},{"tailPos":2465,"headPos":2264,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\na : Fin (n + 1)\n⊢ card ↑({a}ᶜ) = card (Fin n)"],"goalsAfter":[],"content":"simp only [Fintype.card_fin, Finset.card_fin, Fintype.card_ofFinset, Finset.filter_ne' _ a,\n      Set.mem_compl_singleton_iff, Finset.card_erase_of_mem (Finset.mem_univ a),\n      add_tsub_cancel_right]"},{"tailPos":2465,"headPos":2252,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ ∀ (a : Fin (n + 1)), card ↑({a}ᶜ) = card (Fin n)"],"goalsAfter":[],"content":"intro a\n    simp only [Fintype.card_fin, Finset.card_fin, Fintype.card_ofFinset, Finset.filter_ne' _ a,\n      Set.mem_compl_singleton_iff, Finset.card_erase_of_mem (Finset.mem_univ a),\n      add_tsub_cancel_right]"},{"tailPos":2247,"headPos":2245,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ ∀ (a : Fin (n + 1)), card ↑({a}ᶜ) = card (Fin n)"],"goalsAfter":[],"content":"by"},{"tailPos":2465,"headPos":2245,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ ∀ (a : Fin (n + 1)), card ↑({a}ᶜ) = card (Fin n)"],"goalsAfter":[],"content":"by\n    intro a\n    simp only [Fintype.card_fin, Finset.card_fin, Fintype.card_ofFinset, Finset.filter_ne' _ a,\n      Set.mem_compl_singleton_iff, Finset.card_erase_of_mem (Finset.mem_univ a),\n      add_tsub_cancel_right]"},{"tailPos":2465,"headPos":2162,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ card ↑(derangements (Fin (n + 2))) =\n    (n + 1) * card ↑(derangements (Fin n)) + (n + 1) * card ↑(derangements (Fin (n + 1)))"],"goalsAfter":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nh1 : ∀ (a : Fin (n + 1)), card ↑({a}ᶜ) = card (Fin n)\n⊢ card ↑(derangements (Fin (n + 2))) =\n    (n + 1) * card ↑(derangements (Fin n)) + (n + 1) * card ↑(derangements (Fin (n + 1)))"],"content":"have h1 : ∀ a : Fin (n + 1), card ({a}ᶜ : Set (Fin (n + 1))) = card (Fin n) := by\n    intro a\n    simp only [Fintype.card_fin, Finset.card_fin, Fintype.card_ofFinset, Finset.filter_ne' _ a,\n      Set.mem_compl_singleton_iff, Finset.card_erase_of_mem (Finset.mem_univ a),\n      add_tsub_cancel_right]"},{"tailPos":2566,"headPos":2533,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nh1 : ∀ (a : Fin (n + 1)), card ↑({a}ᶜ) = card (Fin n)\n⊢ card (Fin (n + 2)) = card (Option (Fin (n + 1)))"],"goalsAfter":[],"content":"simp only [card_fin, card_option]"},{"tailPos":2532,"headPos":2530,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nh1 : ∀ (a : Fin (n + 1)), card ↑({a}ᶜ) = card (Fin n)\n⊢ card (Fin (n + 2)) = card (Option (Fin (n + 1)))"],"goalsAfter":[],"content":"by"},{"tailPos":2566,"headPos":2530,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nh1 : ∀ (a : Fin (n + 1)), card ↑({a}ᶜ) = card (Fin n)\n⊢ card (Fin (n + 2)) = card (Option (Fin (n + 1)))"],"goalsAfter":[],"content":"by simp only [card_fin, card_option]"},{"tailPos":2566,"headPos":2468,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nh1 : ∀ (a : Fin (n + 1)), card ↑({a}ᶜ) = card (Fin n)\n⊢ card ↑(derangements (Fin (n + 2))) =\n    (n + 1) * card ↑(derangements (Fin n)) + (n + 1) * card ↑(derangements (Fin (n + 1)))"],"goalsAfter":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nh1 : ∀ (a : Fin (n + 1)), card ↑({a}ᶜ) = card (Fin n)\nh2 : card (Fin (n + 2)) = card (Option (Fin (n + 1)))\n⊢ card ↑(derangements (Fin (n + 2))) =\n    (n + 1) * card ↑(derangements (Fin n)) + (n + 1) * card ↑(derangements (Fin (n + 1)))"],"content":"have h2 : card (Fin (n + 2)) = card (Option (Fin (n + 1))) := by simp only [card_fin, card_option]"},{"tailPos":2971,"headPos":2638,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nh1 : ∀ (a : Fin (n + 1)), card ↑({a}ᶜ) = card (Fin n)\nh2 : card (Fin (n + 2)) = card (Option (Fin (n + 1)))\n⊢ card ↑(derangements (Fin (n + 2))) =\n    (n + 1) * card ↑(derangements (Fin n)) + (n + 1) * card ↑(derangements (Fin (n + 1)))"],"goalsAfter":[],"content":"simp only [card_derangements_invariant h2,\n    card_congr\n      (@derangementsRecursionEquiv (Fin (n + 1))\n        _),-- push the cardinality through the Σ and ⊕ so that we can use `card_n`\n    card_sigma,\n    card_sum, card_derangements_invariant (h1 _), Finset.sum_const, nsmul_eq_mul, Finset.card_fin,\n    mul_add, Nat.cast_id]"},{"tailPos":2971,"headPos":2162,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ card ↑(derangements (Fin (n + 2))) =\n    (n + 1) * card ↑(derangements (Fin n)) + (n + 1) * card ↑(derangements (Fin (n + 1)))"],"goalsAfter":[],"content":"have h1 : ∀ a : Fin (n + 1), card ({a}ᶜ : Set (Fin (n + 1))) = card (Fin n) := by\n    intro a\n    simp only [Fintype.card_fin, Finset.card_fin, Fintype.card_ofFinset, Finset.filter_ne' _ a,\n      Set.mem_compl_singleton_iff, Finset.card_erase_of_mem (Finset.mem_univ a),\n      add_tsub_cancel_right]\n  have h2 : card (Fin (n + 2)) = card (Option (Fin (n + 1))) := by simp only [card_fin, card_option]\n  -- rewrite the LHS and substitute in our fintype-level equivalence\n  simp only [card_derangements_invariant h2,\n    card_congr\n      (@derangementsRecursionEquiv (Fin (n + 1))\n        _),-- push the cardinality through the Σ and ⊕ so that we can use `card_n`\n    card_sigma,\n    card_sum, card_derangements_invariant (h1 _), Finset.sum_const, nsmul_eq_mul, Finset.card_fin,\n    mul_add, Nat.cast_id]"},{"tailPos":2078,"headPos":2076,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ card ↑(derangements (Fin (n + 2))) =\n    (n + 1) * card ↑(derangements (Fin n)) + (n + 1) * card ↑(derangements (Fin (n + 1)))"],"goalsAfter":[],"content":"by"},{"tailPos":2971,"headPos":2076,"goalsBefore":["α : Type ?u.2521\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ card ↑(derangements (Fin (n + 2))) =\n    (n + 1) * card ↑(derangements (Fin n)) + (n + 1) * card ↑(derangements (Fin (n + 1)))"],"goalsAfter":[],"content":"by\n  -- get some basic results about the size of fin (n+1) plus or minus an element\n  have h1 : ∀ a : Fin (n + 1), card ({a}ᶜ : Set (Fin (n + 1))) = card (Fin n) := by\n    intro a\n    simp only [Fintype.card_fin, Finset.card_fin, Fintype.card_ofFinset, Finset.filter_ne' _ a,\n      Set.mem_compl_singleton_iff, Finset.card_erase_of_mem (Finset.mem_univ a),\n      add_tsub_cancel_right]\n  have h2 : card (Fin (n + 2)) = card (Option (Fin (n + 1))) := by simp only [card_fin, card_option]\n  -- rewrite the LHS and substitute in our fintype-level equivalence\n  simp only [card_derangements_invariant h2,\n    card_congr\n      (@derangementsRecursionEquiv (Fin (n + 1))\n        _),-- push the cardinality through the Σ and ⊕ so that we can use `card_n`\n    card_sigma,\n    card_sum, card_derangements_invariant (h1 _), Finset.sum_const, nsmul_eq_mul, Finset.card_fin,\n    mul_add, Nat.cast_id]"},{"tailPos":3854,"headPos":3832,"goalsBefore":["α : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n"],"goalsAfter":["case zero\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\n⊢ ↑(numDerangements (Nat.zero + 1)) = (↑Nat.zero + 1) * ↑(numDerangements Nat.zero) - (-1) ^ Nat.zero","case succ\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n\n⊢ ↑(numDerangements (Nat.succ n + 1)) = (↑(Nat.succ n) + 1) * ↑(numDerangements (Nat.succ n)) - (-1) ^ Nat.succ n"],"content":"induction' n with n hn"},{"tailPos":3859,"headPos":3857,"goalsBefore":["case zero\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\n⊢ ↑(numDerangements (Nat.zero + 1)) = (↑Nat.zero + 1) * ↑(numDerangements Nat.zero) - (-1) ^ Nat.zero","case succ\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n\n⊢ ↑(numDerangements (Nat.succ n + 1)) = (↑(Nat.succ n) + 1) * ↑(numDerangements (Nat.succ n)) - (-1) ^ Nat.succ n"],"goalsAfter":["case zero\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\n⊢ ↑(numDerangements (Nat.zero + 1)) = (↑Nat.zero + 1) * ↑(numDerangements Nat.zero) - (-1) ^ Nat.zero"],"content":"·"},{"tailPos":3863,"headPos":3860,"goalsBefore":["case zero\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\n⊢ ↑(numDerangements (Nat.zero + 1)) = (↑Nat.zero + 1) * ↑(numDerangements Nat.zero) - (-1) ^ Nat.zero"],"goalsAfter":[],"content":"rfl"},{"tailPos":3863,"headPos":3857,"goalsBefore":["case zero\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\n⊢ ↑(numDerangements (Nat.zero + 1)) = (↑Nat.zero + 1) * ↑(numDerangements Nat.zero) - (-1) ^ Nat.zero","case succ\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n\n⊢ ↑(numDerangements (Nat.succ n + 1)) = (↑(Nat.succ n) + 1) * ↑(numDerangements (Nat.succ n)) - (-1) ^ Nat.succ n"],"goalsAfter":["case succ\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n\n⊢ ↑(numDerangements (Nat.succ n + 1)) = (↑(Nat.succ n) + 1) * ↑(numDerangements (Nat.succ n)) - (-1) ^ Nat.succ n"],"content":"· rfl"},{"tailPos":3868,"headPos":3866,"goalsBefore":["case succ\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n\n⊢ ↑(numDerangements (Nat.succ n + 1)) = (↑(Nat.succ n) + 1) * ↑(numDerangements (Nat.succ n)) - (-1) ^ Nat.succ n"],"goalsAfter":["case succ\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n\n⊢ ↑(numDerangements (Nat.succ n + 1)) = (↑(Nat.succ n) + 1) * ↑(numDerangements (Nat.succ n)) - (-1) ^ Nat.succ n"],"content":"·"},{"tailPos":3964,"headPos":3869,"goalsBefore":["case succ\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n\n⊢ ↑(numDerangements (Nat.succ n + 1)) = (↑(Nat.succ n) + 1) * ↑(numDerangements (Nat.succ n)) - (-1) ^ Nat.succ n"],"goalsAfter":["case succ\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n\n⊢ (↑n + 1) * (↑(numDerangements n) + ((↑n + 1) * ↑(numDerangements n) - (-1) ^ n)) =\n    (↑n + 1 + 1) * ((↑n + 1) * ↑(numDerangements n) - (-1) ^ n) - -1 * (-1) ^ n"],"content":"simp only [numDerangements_add_two, hn, pow_succ, Int.ofNat_mul, Int.ofNat_add, Int.ofNat_succ]"},{"tailPos":3973,"headPos":3969,"goalsBefore":["case succ\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n\n⊢ (↑n + 1) * (↑(numDerangements n) + ((↑n + 1) * ↑(numDerangements n) - (-1) ^ n)) =\n    (↑n + 1 + 1) * ((↑n + 1) * ↑(numDerangements n) - (-1) ^ n) - -1 * (-1) ^ n"],"goalsAfter":[],"content":"ring"},{"tailPos":3973,"headPos":3869,"goalsBefore":["case succ\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n\n⊢ ↑(numDerangements (Nat.succ n + 1)) = (↑(Nat.succ n) + 1) * ↑(numDerangements (Nat.succ n)) - (-1) ^ Nat.succ n"],"goalsAfter":[],"content":"simp only [numDerangements_add_two, hn, pow_succ, Int.ofNat_mul, Int.ofNat_add, Int.ofNat_succ]\n    ring"},{"tailPos":3973,"headPos":3866,"goalsBefore":["case succ\nα : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n\n⊢ ↑(numDerangements (Nat.succ n + 1)) = (↑(Nat.succ n) + 1) * ↑(numDerangements (Nat.succ n)) - (-1) ^ Nat.succ n"],"goalsAfter":[],"content":"· simp only [numDerangements_add_two, hn, pow_succ, Int.ofNat_mul, Int.ofNat_add, Int.ofNat_succ]\n    ring"},{"tailPos":3973,"headPos":3832,"goalsBefore":["α : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n"],"goalsAfter":[],"content":"induction' n with n hn\n  · rfl\n  · simp only [numDerangements_add_two, hn, pow_succ, Int.ofNat_mul, Int.ofNat_add, Int.ofNat_succ]\n    ring"},{"tailPos":3829,"headPos":3827,"goalsBefore":["α : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n"],"goalsAfter":[],"content":"by"},{"tailPos":3973,"headPos":3827,"goalsBefore":["α : Type ?u.11655\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ ↑(numDerangements (n + 1)) = (↑n + 1) * ↑(numDerangements n) - (-1) ^ n"],"goalsAfter":[],"content":"by\n  induction' n with n hn\n  · rfl\n  · simp only [numDerangements_add_two, hn, pow_succ, Int.ofNat_mul, Int.ofNat_add, Int.ofNat_succ]\n    ring"},{"tailPos":4199,"headPos":4146,"goalsBefore":["α : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ card ↑(derangements (Fin n)) = numDerangements n"],"goalsAfter":["case h\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < n → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin n)) = numDerangements n"],"content":"induction' n using Nat.strong_induction_on with n hyp"},{"tailPos":4225,"headPos":4202,"goalsBefore":["case h\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < n → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin n)) = numDerangements n"],"goalsAfter":["case h.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin Nat.zero)) = numDerangements Nat.zero","case h.succ.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.succ Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ Nat.zero))) = numDerangements (Nat.succ Nat.zero)","case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ (Nat.succ n)))) = numDerangements (Nat.succ (Nat.succ n))"],"content":"rcases n with _ | _ | n"},{"tailPos":4296,"headPos":4294,"goalsBefore":["case h.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin Nat.zero)) = numDerangements Nat.zero","case h.succ.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.succ Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ Nat.zero))) = numDerangements (Nat.succ Nat.zero)","case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ (Nat.succ n)))) = numDerangements (Nat.succ (Nat.succ n))"],"goalsAfter":["case h.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin Nat.zero)) = numDerangements Nat.zero"],"content":"·"},{"tailPos":4378,"headPos":4297,"goalsBefore":["case h.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin Nat.zero)) = numDerangements Nat.zero"],"goalsAfter":["case h.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑{f | ∀ (x : Fin 0), ↑f x ≠ x} = numDerangements Nat.zero"],"content":"convert_to card ↑{ f : Perm (Fin 0) | ∀ (x : Fin 0), f x ≠ x }  = _ using 2"},{"tailPos":4379,"headPos":4378,"goalsBefore":["case h.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑{f | ∀ (x : Fin 0), ↑f x ≠ x} = numDerangements Nat.zero"],"goalsAfter":["case h.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑{f | ∀ (x : Fin 0), ↑f x ≠ x} = numDerangements Nat.zero"],"content":";"},{"tailPos":4383,"headPos":4380,"goalsBefore":["case h.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑{f | ∀ (x : Fin 0), ↑f x ≠ x} = numDerangements Nat.zero"],"goalsAfter":[],"content":"rfl"},{"tailPos":4383,"headPos":4297,"goalsBefore":["case h.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin Nat.zero)) = numDerangements Nat.zero"],"goalsAfter":[],"content":"convert_to card ↑{ f : Perm (Fin 0) | ∀ (x : Fin 0), f x ≠ x }  = _ using 2; rfl"},{"tailPos":4383,"headPos":4294,"goalsBefore":["case h.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin Nat.zero)) = numDerangements Nat.zero","case h.succ.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.succ Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ Nat.zero))) = numDerangements (Nat.succ Nat.zero)","case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ (Nat.succ n)))) = numDerangements (Nat.succ (Nat.succ n))"],"goalsAfter":["case h.succ.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.succ Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ Nat.zero))) = numDerangements (Nat.succ Nat.zero)","case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ (Nat.succ n)))) = numDerangements (Nat.succ (Nat.succ n))"],"content":"· convert_to card ↑{ f : Perm (Fin 0) | ∀ (x : Fin 0), f x ≠ x }  = _ using 2; rfl"},{"tailPos":4388,"headPos":4386,"goalsBefore":["case h.succ.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.succ Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ Nat.zero))) = numDerangements (Nat.succ Nat.zero)","case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ (Nat.succ n)))) = numDerangements (Nat.succ (Nat.succ n))"],"goalsAfter":["case h.succ.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.succ Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ Nat.zero))) = numDerangements (Nat.succ Nat.zero)"],"content":"·"},{"tailPos":4470,"headPos":4389,"goalsBefore":["case h.succ.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.succ Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ Nat.zero))) = numDerangements (Nat.succ Nat.zero)"],"goalsAfter":["case h.succ.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.succ Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑{f | ∀ (x : Fin 1), ↑f x ≠ x} = numDerangements (Nat.succ Nat.zero)"],"content":"convert_to card ↑{ f : Perm (Fin 1) | ∀ (x : Fin 1), f x ≠ x }  = _ using 2"},{"tailPos":4471,"headPos":4470,"goalsBefore":["case h.succ.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.succ Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑{f | ∀ (x : Fin 1), ↑f x ≠ x} = numDerangements (Nat.succ Nat.zero)"],"goalsAfter":["case h.succ.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.succ Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑{f | ∀ (x : Fin 1), ↑f x ≠ x} = numDerangements (Nat.succ Nat.zero)"],"content":";"},{"tailPos":4475,"headPos":4472,"goalsBefore":["case h.succ.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.succ Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑{f | ∀ (x : Fin 1), ↑f x ≠ x} = numDerangements (Nat.succ Nat.zero)"],"goalsAfter":[],"content":"rfl"},{"tailPos":4475,"headPos":4389,"goalsBefore":["case h.succ.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.succ Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ Nat.zero))) = numDerangements (Nat.succ Nat.zero)"],"goalsAfter":[],"content":"convert_to card ↑{ f : Perm (Fin 1) | ∀ (x : Fin 1), f x ≠ x }  = _ using 2; rfl"},{"tailPos":4475,"headPos":4386,"goalsBefore":["case h.succ.zero\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nhyp : ∀ (m : ℕ), m < Nat.succ Nat.zero → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ Nat.zero))) = numDerangements (Nat.succ Nat.zero)","case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ (Nat.succ n)))) = numDerangements (Nat.succ (Nat.succ n))"],"goalsAfter":["case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ (Nat.succ n)))) = numDerangements (Nat.succ (Nat.succ n))"],"content":"· convert_to card ↑{ f : Perm (Fin 1) | ∀ (x : Fin 1), f x ≠ x }  = _ using 2; rfl"},{"tailPos":4667,"headPos":4643,"goalsBefore":["case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ (Nat.succ n)))) = numDerangements (Nat.succ (Nat.succ n))"],"goalsAfter":["case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ (Nat.succ n)))) = (n + 1) * (numDerangements n + numDerangements (n + 1))"],"content":"numDerangements_add_two,"},{"tailPos":4698,"headPos":4668,"goalsBefore":["case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ (Nat.succ n)))) = (n + 1) * (numDerangements n + numDerangements (n + 1))"],"goalsAfter":["case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ (n + 1) * card ↑(derangements (Fin n)) + (n + 1) * card ↑(derangements (Fin (n + 1))) =\n    (n + 1) * (numDerangements n + numDerangements (n + 1))"],"content":"card_derangements_fin_add_two,"},{"tailPos":4707,"headPos":4699,"goalsBefore":["case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ (n + 1) * card ↑(derangements (Fin n)) + (n + 1) * card ↑(derangements (Fin (n + 1))) =\n    (n + 1) * (numDerangements n + numDerangements (n + 1))"],"goalsAfter":["case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ (n + 1) * card ↑(derangements (Fin n)) + (n + 1) * card ↑(derangements (Fin (n + 1))) =\n    (n + 1) * numDerangements n + (n + 1) * numDerangements (n + 1)"],"content":"mul_add,"},{"tailPos":4756,"headPos":4712,"goalsBefore":["case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ (n + 1) * card ↑(derangements (Fin n)) + (n + 1) * card ↑(derangements (Fin (n + 1))) =\n    (n + 1) * numDerangements n + (n + 1) * numDerangements (n + 1)"],"goalsAfter":["case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ (n + 1) * numDerangements n + (n + 1) * card ↑(derangements (Fin (n + 1))) =\n    (n + 1) * numDerangements n + (n + 1) * numDerangements (n + 1)"],"content":"hyp _ (Nat.lt_add_of_pos_right zero_lt_two),"},{"tailPos":4777,"headPos":4757,"goalsBefore":["case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ (n + 1) * numDerangements n + (n + 1) * card ↑(derangements (Fin (n + 1))) =\n    (n + 1) * numDerangements n + (n + 1) * numDerangements (n + 1)"],"goalsAfter":["case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ (n + 1) * numDerangements n + (n + 1) * numDerangements (n + 1) =\n    (n + 1) * numDerangements n + (n + 1) * numDerangements (n + 1)"],"content":"hyp _ (lt_add_one _)"},{"tailPos":4778,"headPos":4777,"goalsBefore":["case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ (n + 1) * numDerangements n + (n + 1) * numDerangements (n + 1) =\n    (n + 1) * numDerangements n + (n + 1) * numDerangements (n + 1)"],"goalsAfter":[],"content":"]"},{"tailPos":4778,"headPos":4639,"goalsBefore":["case h.succ.succ\nα : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhyp : ∀ (m : ℕ), m < Nat.succ (Nat.succ n) → card ↑(derangements (Fin m)) = numDerangements m\n⊢ card ↑(derangements (Fin (Nat.succ (Nat.succ n)))) = numDerangements (Nat.succ (Nat.succ n))"],"goalsAfter":[],"content":"rw [numDerangements_add_two, card_derangements_fin_add_two, mul_add,\n    hyp _ (Nat.lt_add_of_pos_right zero_lt_two), hyp _ (lt_add_one _)]"},{"tailPos":4778,"headPos":4146,"goalsBefore":["α : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ card ↑(derangements (Fin n)) = numDerangements n"],"goalsAfter":[],"content":"induction' n using Nat.strong_induction_on with n hyp\n  rcases n with _ | _ | n\n  -- porting note: the two `convert_to` weren't necessary before.\n  · convert_to card ↑{ f : Perm (Fin 0) | ∀ (x : Fin 0), f x ≠ x }  = _ using 2; rfl\n  · convert_to card ↑{ f : Perm (Fin 1) | ∀ (x : Fin 1), f x ≠ x }  = _ using 2; rfl\n  -- knock out cases 0 and 1\n  -- now we have n ≥ 2. rewrite everything in terms of card_derangements, so that we can use\n  -- `card_derangements_fin_add_two`\n  rw [numDerangements_add_two, card_derangements_fin_add_two, mul_add,\n    hyp _ (Nat.lt_add_of_pos_right zero_lt_two), hyp _ (lt_add_one _)]"},{"tailPos":4143,"headPos":4141,"goalsBefore":["α : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ card ↑(derangements (Fin n)) = numDerangements n"],"goalsAfter":[],"content":"by"},{"tailPos":4778,"headPos":4141,"goalsBefore":["α : Type ?u.13112\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ card ↑(derangements (Fin n)) = numDerangements n"],"goalsAfter":[],"content":"by\n  induction' n using Nat.strong_induction_on with n hyp\n  rcases n with _ | _ | n\n  -- porting note: the two `convert_to` weren't necessary before.\n  · convert_to card ↑{ f : Perm (Fin 0) | ∀ (x : Fin 0), f x ≠ x }  = _ using 2; rfl\n  · convert_to card ↑{ f : Perm (Fin 1) | ∀ (x : Fin 1), f x ≠ x }  = _ using 2; rfl\n  -- knock out cases 0 and 1\n  -- now we have n ≥ 2. rewrite everything in terms of card_derangements, so that we can use\n  -- `card_derangements_fin_add_two`\n  rw [numDerangements_add_two, card_derangements_fin_add_two, mul_add,\n    hyp _ (Nat.lt_add_of_pos_right zero_lt_two), hyp _ (lt_add_one _)]"},{"tailPos":5072,"headPos":5028,"goalsBefore":["α✝ : Type ?u.21453\ninst✝³ : DecidableEq α✝\ninst✝² : Fintype α✝\nα : Type u_1\ninst✝¹ : Fintype α\ninst✝ : DecidableEq α\n⊢ card ↑(derangements α) = numDerangements (card α)"],"goalsAfter":["α✝ : Type ?u.21453\ninst✝³ : DecidableEq α✝\ninst✝² : Fintype α✝\nα : Type u_1\ninst✝¹ : Fintype α\ninst✝ : DecidableEq α\n⊢ card ↑(derangements (Fin (card α))) = numDerangements (card α)"],"content":"← card_derangements_invariant (card_fin _)"},{"tailPos":5073,"headPos":5072,"goalsBefore":["α✝ : Type ?u.21453\ninst✝³ : DecidableEq α✝\ninst✝² : Fintype α✝\nα : Type u_1\ninst✝¹ : Fintype α\ninst✝ : DecidableEq α\n⊢ card ↑(derangements (Fin (card α))) = numDerangements (card α)"],"goalsAfter":["α✝ : Type ?u.21453\ninst✝³ : DecidableEq α✝\ninst✝² : Fintype α✝\nα : Type u_1\ninst✝¹ : Fintype α\ninst✝ : DecidableEq α\n⊢ card ↑(derangements (Fin (card α))) = numDerangements (card α)"],"content":"]"},{"tailPos":5073,"headPos":5024,"goalsBefore":["α✝ : Type ?u.21453\ninst✝³ : DecidableEq α✝\ninst✝² : Fintype α✝\nα : Type u_1\ninst✝¹ : Fintype α\ninst✝ : DecidableEq α\n⊢ card ↑(derangements α) = numDerangements (card α)"],"goalsAfter":["α✝ : Type ?u.21453\ninst✝³ : DecidableEq α✝\ninst✝² : Fintype α✝\nα : Type u_1\ninst✝¹ : Fintype α\ninst✝ : DecidableEq α\n⊢ card ↑(derangements (Fin (card α))) = numDerangements (card α)"],"content":"rw [← card_derangements_invariant (card_fin _)]"},{"tailPos":5122,"headPos":5076,"goalsBefore":["α✝ : Type ?u.21453\ninst✝³ : DecidableEq α✝\ninst✝² : Fintype α✝\nα : Type u_1\ninst✝¹ : Fintype α\ninst✝ : DecidableEq α\n⊢ card ↑(derangements (Fin (card α))) = numDerangements (card α)"],"goalsAfter":[],"content":"exact card_derangements_fin_eq_numDerangements"},{"tailPos":5122,"headPos":5024,"goalsBefore":["α✝ : Type ?u.21453\ninst✝³ : DecidableEq α✝\ninst✝² : Fintype α✝\nα : Type u_1\ninst✝¹ : Fintype α\ninst✝ : DecidableEq α\n⊢ card ↑(derangements α) = numDerangements (card α)"],"goalsAfter":[],"content":"rw [← card_derangements_invariant (card_fin _)]\n  exact card_derangements_fin_eq_numDerangements"},{"tailPos":5021,"headPos":5019,"goalsBefore":["α✝ : Type ?u.21453\ninst✝³ : DecidableEq α✝\ninst✝² : Fintype α✝\nα : Type u_1\ninst✝¹ : Fintype α\ninst✝ : DecidableEq α\n⊢ card ↑(derangements α) = numDerangements (card α)"],"goalsAfter":[],"content":"by"},{"tailPos":5122,"headPos":5019,"goalsBefore":["α✝ : Type ?u.21453\ninst✝³ : DecidableEq α✝\ninst✝² : Fintype α✝\nα : Type u_1\ninst✝¹ : Fintype α\ninst✝ : DecidableEq α\n⊢ card ↑(derangements α) = numDerangements (card α)"],"goalsAfter":[],"content":"by\n  rw [← card_derangements_invariant (card_fin _)]\n  exact card_derangements_fin_eq_numDerangements"},{"tailPos":5389,"headPos":5367,"goalsBefore":["α : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))"],"goalsAfter":["case zero\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\n⊢ ↑(numDerangements Nat.zero) = ∑ k in Finset.range (Nat.zero + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.zero - k))","case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ↑(numDerangements (Nat.succ n)) =\n    ∑ k in Finset.range (Nat.succ n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.succ n - k))"],"content":"induction' n with n hn"},{"tailPos":5390,"headPos":5389,"goalsBefore":["case zero\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\n⊢ ↑(numDerangements Nat.zero) = ∑ k in Finset.range (Nat.zero + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.zero - k))","case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ↑(numDerangements (Nat.succ n)) =\n    ∑ k in Finset.range (Nat.succ n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.succ n - k))"],"goalsAfter":["case zero\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\n⊢ ↑(numDerangements Nat.zero) = ∑ k in Finset.range (Nat.zero + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.zero - k))","case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ↑(numDerangements (Nat.succ n)) =\n    ∑ k in Finset.range (Nat.succ n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.succ n - k))"],"content":";"},{"tailPos":5393,"headPos":5391,"goalsBefore":["case zero\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\n⊢ ↑(numDerangements Nat.zero) = ∑ k in Finset.range (Nat.zero + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.zero - k))","case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ↑(numDerangements (Nat.succ n)) =\n    ∑ k in Finset.range (Nat.succ n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.succ n - k))"],"goalsAfter":["case zero\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\n⊢ ↑(numDerangements Nat.zero) = ∑ k in Finset.range (Nat.zero + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.zero - k))"],"content":"·"},{"tailPos":5397,"headPos":5394,"goalsBefore":["case zero\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\n⊢ ↑(numDerangements Nat.zero) = ∑ k in Finset.range (Nat.zero + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.zero - k))"],"goalsAfter":[],"content":"rfl"},{"tailPos":5397,"headPos":5391,"goalsBefore":["case zero\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\n⊢ ↑(numDerangements Nat.zero) = ∑ k in Finset.range (Nat.zero + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.zero - k))","case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ↑(numDerangements (Nat.succ n)) =\n    ∑ k in Finset.range (Nat.succ n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.succ n - k))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ↑(numDerangements (Nat.succ n)) =\n    ∑ k in Finset.range (Nat.succ n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.succ n - k))"],"content":"· rfl"},{"tailPos":5426,"headPos":5404,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ↑(numDerangements (Nat.succ n)) =\n    ∑ k in Finset.range (Nat.succ n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.succ n - k))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ↑(numDerangements (Nat.succ n)) =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) +\n      (-1) ^ (n + 1) * ↑(Nat.ascFactorial (n + 1) (Nat.succ n - (n + 1)))"],"content":"Finset.sum_range_succ,"},{"tailPos":5448,"headPos":5427,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ↑(numDerangements (Nat.succ n)) =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) +\n      (-1) ^ (n + 1) * ↑(Nat.ascFactorial (n + 1) (Nat.succ n - (n + 1)))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ (↑n + 1) * ↑(numDerangements n) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) +\n      (-1) ^ (n + 1) * ↑(Nat.ascFactorial (n + 1) (Nat.succ n - (n + 1)))"],"content":"numDerangements_succ,"},{"tailPos":5452,"headPos":5449,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ (↑n + 1) * ↑(numDerangements n) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) +\n      (-1) ^ (n + 1) * ↑(Nat.ascFactorial (n + 1) (Nat.succ n - (n + 1)))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ (↑n + 1) * ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k)) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) +\n      (-1) ^ (n + 1) * ↑(Nat.ascFactorial (n + 1) (Nat.succ n - (n + 1)))"],"content":"hn,"},{"tailPos":5468,"headPos":5453,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ (↑n + 1) * ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k)) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) +\n      (-1) ^ (n + 1) * ↑(Nat.ascFactorial (n + 1) (Nat.succ n - (n + 1)))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) +\n      (-1) ^ (n + 1) * ↑(Nat.ascFactorial (n + 1) (Nat.succ n - (n + 1)))"],"content":"Finset.mul_sum,"},{"tailPos":5479,"headPos":5469,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) +\n      (-1) ^ (n + 1) * ↑(Nat.ascFactorial (n + 1) (Nat.succ n - (n + 1)))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) +\n      (-1) ^ (n + 1) * ↑(Nat.ascFactorial (n + 1) 0)"],"content":"tsub_self,"},{"tailPos":5506,"headPos":5484,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) +\n      (-1) ^ (n + 1) * ↑(Nat.ascFactorial (n + 1) 0)"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) + (-1) ^ (n + 1) * ↑1"],"content":"Nat.ascFactorial_zero,"},{"tailPos":5521,"headPos":5507,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) + (-1) ^ (n + 1) * ↑1"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) + (-1) ^ (n + 1) * 1"],"content":"Int.ofNat_one,"},{"tailPos":5530,"headPos":5522,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) + (-1) ^ (n + 1) * 1"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) + (-1) ^ (n + 1)"],"content":"mul_one,"},{"tailPos":5540,"headPos":5531,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) + (-1) ^ (n + 1)"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) + -1 * (-1) ^ n"],"content":"pow_succ,"},{"tailPos":5553,"headPos":5541,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) + -1 * (-1) ^ n"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) + -(-1) ^ n"],"content":"neg_one_mul,"},{"tailPos":5569,"headPos":5554,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) - (-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) + -(-1) ^ n"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) + -(-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) + -(-1) ^ n"],"content":"sub_eq_add_neg,"},{"tailPos":5587,"headPos":5574,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) + -(-1) ^ n =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x)) + -(-1) ^ n"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x))"],"content":"add_left_inj,"},{"tailPos":5608,"headPos":5588,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∑ x in Finset.range (n + 1), (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ Finset.sum (Finset.range (n + 1)) ?m.23797 =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x))","case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∀ (x : ℕ), x ∈ Finset.range (n + 1) → (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = ?m.23797 x","α : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ℕ → ℤ"],"content":"Finset.sum_congr rfl"},{"tailPos":5609,"headPos":5608,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ Finset.sum (Finset.range (n + 1)) ?m.23797 =\n    ∑ x in Finset.range (n + 1), (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x))","case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∀ (x : ℕ), x ∈ Finset.range (n + 1) → (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = ?m.23797 x","α : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ℕ → ℤ"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∀ (x : ℕ),\n    x ∈ Finset.range (n + 1) →\n      (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x))"],"content":"]"},{"tailPos":5609,"headPos":5400,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ↑(numDerangements (Nat.succ n)) =\n    ∑ k in Finset.range (Nat.succ n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (Nat.succ n - k))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∀ (x : ℕ),\n    x ∈ Finset.range (n + 1) →\n      (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x))"],"content":"rw [Finset.sum_range_succ, numDerangements_succ, hn, Finset.mul_sum, tsub_self,\n    Nat.ascFactorial_zero, Int.ofNat_one, mul_one, pow_succ, neg_one_mul, sub_eq_add_neg,\n    add_left_inj, Finset.sum_congr rfl]"},{"tailPos":5708,"headPos":5698,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\n⊢ ∀ (x : ℕ),\n    x ∈ Finset.range (n + 1) →\n      (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x))"],"content":"intro x hx"},{"tailPos":5765,"headPos":5711,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x))"],"content":"have h_le : x ≤ n := Finset.mem_range_succ_iff.mp hx"},{"tailPos":5790,"headPos":5772,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ (n - x)))"],"content":"Nat.succ_sub h_le,"},{"tailPos":5813,"headPos":5791,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ (n - x)))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑((x + (n - x) + 1) * Nat.ascFactorial x (n - x))"],"content":"Nat.ascFactorial_succ,"},{"tailPos":5841,"headPos":5814,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑((x + (n - x) + 1) * Nat.ascFactorial x (n - x))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑((n + 1) * Nat.ascFactorial x (n - x))"],"content":"add_tsub_cancel_of_le h_le,"},{"tailPos":5856,"headPos":5842,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑((n + 1) * Nat.ascFactorial x (n - x))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * (↑(n + 1) * ↑(Nat.ascFactorial x (n - x)))"],"content":"Int.ofNat_mul,"},{"tailPos":5876,"headPos":5861,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * (↑(n + 1) * ↑(Nat.ascFactorial x (n - x)))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ((↑n + 1) * ↑(Nat.ascFactorial x (n - x)))"],"content":"Int.ofNat_succ,"},{"tailPos":5890,"headPos":5877,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ((↑n + 1) * ↑(Nat.ascFactorial x (n - x)))"],"goalsAfter":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (-1) ^ x * ((↑n + 1) * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ((↑n + 1) * ↑(Nat.ascFactorial x (n - x)))"],"content":"mul_left_comm"},{"tailPos":5891,"headPos":5890,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (-1) ^ x * ((↑n + 1) * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ((↑n + 1) * ↑(Nat.ascFactorial x (n - x)))"],"goalsAfter":[],"content":"]"},{"tailPos":5891,"headPos":5768,"goalsBefore":["case succ\nα : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\nhn : ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))\nx : ℕ\nhx : x ∈ Finset.range (n + 1)\nh_le : x ≤ n\n⊢ (↑n + 1) * ((-1) ^ x * ↑(Nat.ascFactorial x (n - x))) = (-1) ^ x * ↑(Nat.ascFactorial x (Nat.succ n - x))"],"goalsAfter":[],"content":"rw [Nat.succ_sub h_le, Nat.ascFactorial_succ, add_tsub_cancel_of_le h_le, Int.ofNat_mul,\n    Int.ofNat_succ, mul_left_comm]"},{"tailPos":5891,"headPos":5367,"goalsBefore":["α : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))"],"goalsAfter":[],"content":"induction' n with n hn; · rfl\n  rw [Finset.sum_range_succ, numDerangements_succ, hn, Finset.mul_sum, tsub_self,\n    Nat.ascFactorial_zero, Int.ofNat_one, mul_one, pow_succ, neg_one_mul, sub_eq_add_neg,\n    add_left_inj, Finset.sum_congr rfl]\n  -- show that (n + 1) * (-1)^x * asc_fac x (n - x) = (-1)^x * asc_fac x (n.succ - x)\n  intro x hx\n  have h_le : x ≤ n := Finset.mem_range_succ_iff.mp hx\n  rw [Nat.succ_sub h_le, Nat.ascFactorial_succ, add_tsub_cancel_of_le h_le, Int.ofNat_mul,\n    Int.ofNat_succ, mul_left_comm]"},{"tailPos":5364,"headPos":5362,"goalsBefore":["α : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))"],"goalsAfter":[],"content":"by"},{"tailPos":5891,"headPos":5362,"goalsBefore":["α : Type ?u.22310\ninst✝¹ : DecidableEq α\ninst✝ : Fintype α\nn : ℕ\n⊢ ↑(numDerangements n) = ∑ k in Finset.range (n + 1), (-1) ^ k * ↑(Nat.ascFactorial k (n - k))"],"goalsAfter":[],"content":"by\n  induction' n with n hn; · rfl\n  rw [Finset.sum_range_succ, numDerangements_succ, hn, Finset.mul_sum, tsub_self,\n    Nat.ascFactorial_zero, Int.ofNat_one, mul_one, pow_succ, neg_one_mul, sub_eq_add_neg,\n    add_left_inj, Finset.sum_congr rfl]\n  -- show that (n + 1) * (-1)^x * asc_fac x (n - x) = (-1)^x * asc_fac x (n.succ - x)\n  intro x hx\n  have h_le : x ≤ n := Finset.mem_range_succ_iff.mp hx\n  rw [Nat.succ_sub h_le, Nat.ascFactorial_succ, add_tsub_cancel_of_le h_le, Int.ofNat_mul,\n    Int.ofNat_succ, mul_left_comm]"}]